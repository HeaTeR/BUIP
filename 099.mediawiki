<pre>
BUIP???: Demonstration of Phase in Full Network Upgrade Activated by Miners
Proposer: LIN Zheming
Submitted on: ?
Status: draft
</pre>

==Summary==

本方法并不是来源于个人，而是中文比特币社区中集体智慧的结果。

这是一种在协议升级时，对全网挖矿和非挖矿节点进行保护和激励的方法，避免不参与挖矿的节点没有升级的动力而受到损失。通过多数矿工在激活后设置区块版本号，在宽限期（约两个难度周期）中孤立未升级矿工的块，通过最初的中本聪共识，来迫使所有矿工均升级到最新的共识版本号。在宽限期结束后，所有矿工将升级至最新版本或使用最新版本发送信号。此时，矿工将仅接受新版本的交易，未升级的客户端发送的旧版本交易将无法得到新节点的转播也无法进入新版本区块。这将在保护用户资产的同时，提醒不挖矿的钱包节点升级。

==Motivation==

鉴于比特币协议改进涉及到多方面参与者，最初的比特币协议并未考虑不参与挖矿的钱包节点，导致这些钱包节点的协议升级是被动的，懒惰的。而在升级方向上出现分歧时，钱包节点的安全将被影响，而矿工也不愿意在错误的链上挖矿，但矿工又没有任何方法可以确保正在延长的链是被钱包节点广泛接受的链。

使用该方法可以在保证钱包节点资产安全的情况下，且通过增加激励让钱包节点升级协议。一旦钱包节点升级协议，保证矿工节点不仅工作在算力最长链上，还工作在比特币生态环境中其他钱包节点所使用的最长链上。在中本聪共识下不会出现分叉，以实现渐进式的协议升级。

==Proposal==

1. 挖矿节点使用 BIP9 风格的版本位来定义支持信号。<br>
2. 挖矿节点使用 block version／tx version 来定义当前的块和交易版本。<br>
3. 挖矿节点在监测到 55% 的区块即前 594/1080 个区块均发送了支持信号，且经过了第一个宽限期 1080 的区块后，总信号区块超过了 1188/2160，就开始使用新的区块版本打包区块，并同时开始孤立旧版本。<br>
4. 所有节点和钱包，将在同时使用新版本号发送交易。<br>
5. 在挖矿节点监测到第二个宽限期 2160 个新版本的区块后，开始拒绝旧版本号的交易，只打包／转播新版本号的交易。同时将从内存池中删除旧版本号的交易。<br>

至此，协议升级完成。

==Benefits==

激活时是一种”软分叉”，多数的矿工发信号后即可激活。在中本聪的比特币论文中，99.9% 的可能性下，55% 的矿工将在 340 个区块后确保成为最长链。这将最大可能减小通过控制少数算力而拖延网络升级的可能性。我们可以预见到在算力信号超过 51% 后，将迅速的在第一个宽限期后进行升级。

在两个宽限期内，钱包节点交易不受影响，有足够的时间升级钱包软件。

版本信息包含在 block header 中，并不影响 SPV 挖矿过程。（看起来是？）

在两个宽限期后，钱包节点将必须升级钱包，否则因没有算力支持将无法发送交易，也无法确认。相对于节点间重新达成新标准共识，这种状况并没有更糟糕。

钱包节点的账本将得到尊重和保护。使用链下钱包的用户将需要在钱包服务提供商的声明之后决定提至链上钱包或跟随。

将来的协议升级，可以在升级客户端版本同时绑定在拒绝旧版本号交易之后的第三个宽限期开始激活的协议升级代码。这将预留足够的时间让节点升级软件以支持新的协议。

==Implementation==
___TBD___
